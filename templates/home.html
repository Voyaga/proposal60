<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>60-Second Proposal</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="brand-mark">GTJ</div>
      <div class="brand-text">
        <div class="brand-name">Get The Job</div>
        <div class="brand-tag">Client-ready proposals that help win the job.</div>
      </div>
    </div>

    <h1>Send a professional proposal in 60 seconds.</h1>
    <p class="subhead">Client-ready proposals, built for real work.</p>

    <!-- =====================
         Recent Proposals
    ====================== -->
    <div id="proposalHistory"></div>

    <hr>

    <!-- =====================
         Proposal Form
    ====================== -->
    <form id="proposalForm" method="POST" action="/generate">
      <label>Your business name</label>
      <input name="your_business" placeholder="e.g., Neo Electrical" />

      <label>Type of work / trade</label>
      <select name="trade">
        <option value="general">General Trade</option>
        <option value="electrician">Electrician</option>
        <option value="plumber">Plumber</option>
        <option value="builder">Builder / Renovation</option>
        <option value="hvac">HVAC</option>
        <option value="cleaner">Cleaning</option>
      </select>

      <label>Client name *</label>
      <input name="client_name" required />

      <label>Service type</label>
      <input name="service_type" placeholder="e.g., Bathroom renovation" />

      <label>Scope (bullet notes) *</label>
      <textarea
        name="scope"
        rows="6"
        required
        placeholder="- Supply and install...&#10;- Remove old..."></textarea>

      <label>Price</label>
      <input name="price" placeholder="e.g., $2,450 incl GST" />

      <label>Tone</label>
      <select name="tone">
        <option>Professional</option>
        <option>Friendly</option>
        <option>Direct</option>
      </select>

      <label>ABN (optional)</label>
      <input name="abn" placeholder="e.g., 12 345 678 901" />

      <label>Phone (optional)</label>
      <input name="phone" placeholder="e.g., 0400 123 456" />

      <label>Email (optional)</label>
      <input name="email" placeholder="e.g., info@business.com.au" />

      <button id="generateBtn" class="btn" type="submit">
        Generate Proposal →
      </button>

      <p class="fineprint">
        Tip: keep scope as short bullet notes for the best results.
      </p>
    </form>
  </div>

<script>
/* -------------------------
   Proposal History (Home)
------------------------- */
const HISTORY_KEY = "gtj_proposal_history";

function loadHistory() {
  try {
    return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
  } catch {
    return [];
  }
}

function renderHistory() {
  const container = document.getElementById("proposalHistory");
  if (!container) return;

  const history = loadHistory();

  if (!history.length) {
    container.innerHTML = `
      <p class="helper">
        No recent proposals yet.
      </p>
    `;
    return;
  }

  container.innerHTML = `
    <h3>Recent proposals</h3>
    <ul>
      ${history.map((h, i) => `
        <li style="margin-bottom:12px;">
          <a href="#" onclick="openProposal(${i}); return false;">
            ${h.client} – ${h.service}
          </a>
          <div style="font-size:12px;opacity:.7;">
            ${new Date(h.createdAt).toLocaleString()}
          </div>
        </li>
      `).join("")}
    </ul>
  `;
}

function openProposal(index) {
  const history = loadHistory();
  const item = history[index];
  if (!item) return;

  // Open preview in a new tab with stored content
  const w = window.open("", "_blank");
  if (!w) return;

  w.document.write(`
    <pre style="
      white-space:pre-wrap;
      font-family:ui-monospace, monospace;
      padding:24px;
      max-width:900px;
      margin:auto;
    ">${item.text.replace(/</g,"&lt;")}</pre>
  `);
  w.document.close();
}

document.addEventListener("DOMContentLoaded", renderHistory);

/* -------------------------
   Form UX
------------------------- */
const form = document.getElementById("proposalForm");
const btn = document.getElementById("generateBtn");

form.addEventListener("submit", () => {
  btn.disabled = true;
  btn.textContent = "Generating…";
});

window.addEventListener("pageshow", () => {
  btn.disabled = false;
  btn.textContent = "Generate Proposal →";
});
</script>


</body>
</html>
